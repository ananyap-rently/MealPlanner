<div class="container">
  <div class="page-header">
    <h1>ğŸ½ï¸ Meal Planning System</h1>
    <p>Plan your weekly meals and create shopping lists</p>
  </div>

  <% if notice %>
    <div class="flash-notice"><%= notice %></div>
  <% end %>

  <% if alert %>
    <div class="flash-alert"><%= alert %></div>
  <% end %>

  <div class="create-section">
    <h2>Create New Meal Plan</h2>

    <% if @meal_plan.errors.any? %>
      <div class="error-messages">
        <h3><%= pluralize(@meal_plan.errors.count, "error") %> prevented this meal plan from being saved:</h3>
        <ul>
          <% @meal_plan.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with(model: @meal_plan, local: true) do |form| %>
      <div class="form-row">
        <div class="form-group">
          <%= form.label :category, "Meal Plan Name" %>
          <%= form.text_field :category, 
              class: "form-control", 
              placeholder: "e.g., Veg Meal Plan, Keto Week" %>
        </div>

        <div class="form-group">
          <%= form.label :start_date, "Start Date" %>
          <%= form.date_field :start_date, 
              class: "form-control",
              value: Date.today,
              min: Date.today %>
        </div>

        <div class="form-group">
          <%= form.submit "Create Plan", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="plans-section">
    <h2>All Meal Plans</h2>

    <% if @meal_plans.any? %>
      <div class="plans-grid">
        <% @meal_plans.each do |plan| %>
          <div class="plan-card">
            <div class="plan-header">
              <h3><%= plan.category %></h3>
              <div class="plan-meta">
                <strong>ğŸ“… Start Date:</strong> <%= plan.start_date.strftime("%B %d, %Y") %>
              </div>
              <div class="plan-meta">
                <strong>ğŸ‘¤ Created by:</strong> <%= plan.user.email %>
              </div>
              <div class="plan-meta">
                <strong>ğŸ“ Items:</strong> <%= plan.meal_plan_items.count %>
              </div>
              <div class="plan-meta">
                <strong>ğŸ’¬ Comments:</strong> <%= plan.comments.count %>
              </div>
            </div>

            <div class="plan-actions">
              <%= link_to "Go to Meal Plan", meal_plan_path(plan), class: "btn btn-success btn-small" %>
              
              <% if plan.user == current_user %>
                <%= link_to "Delete", 
                    meal_plan_path(plan), 
                    method: :delete, 
                    data: { confirm: "Are you sure you want to delete this meal plan?" }, 
                    class: "btn btn-danger btn-small" %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <p>No meal plans created yet. Create your first meal plan above!</p>
      </div>
    <% end %>
  </div>
</div>