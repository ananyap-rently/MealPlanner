<div class="container">
  <h1>Meal Plans</h1>

  <% if notice %>
    <div class="alert alert-success"><%= notice %></div>
  <% end %>

  <% if alert %>
    <div class="alert alert-danger"><%= alert %></div>
  <% end %>

  <!-- Create New Meal Plan Form -->
  <div class="card mb-4">
    <div class="card-header">
      <h3>Create New Meal Plan</h3>
    </div>
    <div class="card-body">
      <%= form_with model: @meal_plan, local: true do |f| %>
        <% if @meal_plan.errors.any? %>
          <div class="alert alert-danger">
            <h4><%= pluralize(@meal_plan.errors.count, "error") %> prohibited this meal plan from being saved:</h4>
            <ul>
              <% @meal_plan.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="form-group mb-3">
          <%= f.label :category, "Category" %>
          <%= f.text_field :category, class: "form-control", placeholder: "e.g., Weekly, Special Diet, Holiday" %>
        </div>

        <div class="form-group mb-3">
          <%= f.label :start_date, "Start Date" %>
          <%= f.date_field :start_date, class: "form-control", value: Date.today %>
        </div>

        <%= f.submit "Create Meal Plan", class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>

  <!-- List of Existing Meal Plans -->
  <div class="card">
    <div class="card-header">
      <h3>Your Meal Plans</h3>
    </div>
    <div class="card-body">
      <% if @meal_plans.any? %>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Category</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Created By</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @meal_plans.each do |meal_plan| %>
              <tr>
                <td><%= meal_plan.category %></td>
                <td><%= meal_plan.start_date.strftime("%B %d, %Y") %></td>
                <td><%= meal_plan.end_date.strftime("%B %d, %Y") %></td>
                <td><%= meal_plan.user.email %></td>
                <td>
                  <%= link_to "View", meal_plan_path(meal_plan), class: "btn btn-sm btn-info" %>
                  <% if meal_plan.user == current_user %>
                    <%= button_to "Delete", meal_plan_path(meal_plan), 
                        method: :delete, 
                        class: "btn btn-sm btn-danger",
                        form: { data: { turbo_confirm: "Are you sure?" } } %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="text-muted">No meal plans yet. Create your first one above!</p>
      <% end %>
    </div>
  </div>
</div>
